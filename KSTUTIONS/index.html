<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KS Tuitions - Complete Learning System</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
  const { useState, useEffect } = React;
  
  const Icon = ({ path, className = "w-5 h-5" }) => (
    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={path} /></svg>
  );
  const Search = (p) => <Icon path="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" {...p} />;
  const LogOut = (p) => <Icon path="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" {...p} />;
  const Video = (p) => <Icon path="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" {...p} />;
  const FileText = (p) => <Icon path="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" {...p} />;
  const ExternalLink = (p) => <Icon path="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" {...p} />;
  const Edit = (p) => <Icon path="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" {...p} />;
  const Trash2 = (p) => <Icon path="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" {...p} />;
  const Activity = (p) => <Icon path="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" {...p} />;
  const Users = (p) => <Icon path="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" {...p} />;
  const Menu = (p) => <Icon path="M4 6h16M4 12h16M4 18h16" {...p} />;
  const X = (p) => <Icon path="M6 18L18 6M6 6l12 12" {...p} />;
  const Home = (p) => <Icon path="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" {...p} />;
  const BookOpen = (p) => <Icon path="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" {...p} />;
  const Play = (p) => <Icon path="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z M21 12a9 9 0 11-18 0 9 9 0 0118 0z" {...p} />;
  const Film = (p) => <Icon path="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" {...p} />;

  const safeCSVSplit = (line) => {
    const result = []; let cur = ''; let inQuotes = false;
    for (let i = 0; i < line.length; i++) {
      const ch = line[i];
      if (ch === '"' ) { if (inQuotes && line[i+1] === '"') { cur += '"'; i++; } else inQuotes = !inQuotes; }
      else if (ch === ',' && !inQuotes) { result.push(cur); cur = ''; }
      else cur += ch;
    }
    result.push(cur);
    return result.map(s => s.trim().replace(/^"|"$/g, ''));
  };

  const extractVideoId = (url) => {
    const patterns = [
      /(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/,
      /youtube\.com\/embed\/([^&\s]+)/,
      /drive\.google\.com\/file\/d\/([^\/\s]+)/,
      /vimeo\.com\/([0-9]+)/
    ];
    for (let pattern of patterns) {
      const match = url.match(pattern);
      if (match) return { id: match[1], type: url.includes('youtube') || url.includes('youtu.be') ? 'youtube' : url.includes('drive.google') ? 'drive' : 'vimeo' };
    }
    return null;
  };

  const getEmbedUrl = (url) => {
    const videoInfo = extractVideoId(url);
    if (!videoInfo) return null;
    if (videoInfo.type === 'youtube') return `https://www.youtube.com/embed/${videoInfo.id}`;
    if (videoInfo.type === 'drive') return `https://drive.google.com/file/d/${videoInfo.id}/preview`;
    if (videoInfo.type === 'vimeo') return `https://player.vimeo.com/video/${videoInfo.id}`;
    return null;
  };

  const CompleteApp = () => {
    const initialUsers = JSON.parse(localStorage.getItem('ks_complete_users') || 'null') || [
      { id: 1, username: 'admin', password: 'admin123', name: 'Admin', role: 'admin', grade: 'All' },
      { id: 2, username: 'teacher1', password: 'teacher123', name: 'Teacher 1', role: 'teacher', grade: 'All' },
      { id: 3, username: 'student1', password: 'student123', name: 'Student 1', role: 'student', grade: '10' }
    ];
    
    const [currentUser, setCurrentUser] = useState(JSON.parse(localStorage.getItem('ks_complete_currentUser') || 'null'));
    const [users, setUsers] = useState(initialUsers);
    const [notes, setNotes] = useState(JSON.parse(localStorage.getItem('ks_complete_notes') || '[]'));
    const [videos, setVideos] = useState(JSON.parse(localStorage.getItem('ks_complete_videos') || '[]'));
    const [logs, setLogs] = useState(JSON.parse(localStorage.getItem('ks_complete_logs') || '[]'));
    const [filteredContent, setFilteredContent] = useState([]);
    const [searchTerm, setSearchTerm] = useState('');
    const [selectedSubject, setSelectedSubject] = useState(null);
    const [currentView, setCurrentView] = useState('home');
    const [contentType, setContentType] = useState('notes');
    const [editingNote, setEditingNote] = useState(null);
    const [editingVideo, setEditingVideo] = useState(null);
    const [sidebarOpen, setSidebarOpen] = useState(false);
    const [loginForm, setLoginForm] = useState({ username: '', password: '' });
    const [noteForm, setNoteForm] = useState({ title: '', subject: '', chapter: '', grade: '10', description: '', driveLink: '', uploadType: 'link', pdfFile: null, pdfData: null });
    const [videoForm, setVideoForm] = useState({ title: '', subject: '', chapter: '', grade: '10', description: '', videoUrl: '', uploadType: 'link', videoFile: null, videoData: null });
    const [playingVideo, setPlayingVideo] = useState(null);

    const grades = ['6','7','8','9','10','11','12'];
    const subjects = ['Mathematics','Science','English','Social Studies','Hindi','Physics','Chemistry','Biology','Computer Science'];

    useEffect(() => localStorage.setItem('ks_complete_users', JSON.stringify(users)), [users]);
    useEffect(() => localStorage.setItem('ks_complete_notes', JSON.stringify(notes)), [notes]);
    useEffect(() => localStorage.setItem('ks_complete_videos', JSON.stringify(videos)), [videos]);
    useEffect(() => localStorage.setItem('ks_complete_logs', JSON.stringify(logs)), [logs]);
    useEffect(() => localStorage.setItem('ks_complete_currentUser', JSON.stringify(currentUser)), [currentUser]);

    const addLog = (action, details) => {
      if (!currentUser) return;
      setLogs(p => [{ id: Date.now(), time: new Date().toLocaleString(), user: currentUser.name, role: currentUser.role, action, details }, ...p]);
    };

    const handleLogin = () => {
      const user = users.find(u => u.username === loginForm.username && u.password === loginForm.password);
      if (user) {
        setCurrentUser(user);
        setLogs(p => [{ id: Date.now(), time: new Date().toLocaleString(), user: user.name, role: user.role, action: 'LOGIN', details: `${user.role} logged in` }, ...p]);
        setLoginForm({ username: '', password: '' });
        setCurrentView('home');
      } else alert('Invalid username or password');
    };

    const handleLogout = () => {
      addLog('LOGOUT', `${currentUser.role} logged out`);
      setCurrentUser(null); setEditingNote(null); setEditingVideo(null); setSelectedSubject(null); setCurrentView('home'); setPlayingVideo(null);
    };

    const handleUploadNote = () => {
      if (!currentUser) { alert('Login first'); return; }
      if (noteForm.title && noteForm.subject && noteForm.chapter) {
        if (noteForm.uploadType === 'link' && !noteForm.driveLink) { alert('Please provide a link'); return; }
        if (noteForm.uploadType === 'pdf' && !noteForm.pdfData) { alert('Please select a PDF'); return; }
        const note = { 
          id: Date.now(), type: 'note',
          title: noteForm.title, subject: noteForm.subject, chapter: noteForm.chapter, grade: noteForm.grade, description: noteForm.description,
          uploadType: noteForm.uploadType, driveLink: noteForm.uploadType === 'link' ? noteForm.driveLink : null,
          pdfData: noteForm.uploadType === 'pdf' ? noteForm.pdfData : null, pdfFileName: noteForm.uploadType === 'pdf' ? noteForm.pdfFile?.name : null,
          uploadedBy: currentUser.name, uploaderId: currentUser.id, uploadDate: new Date().toLocaleDateString()
        };
        setNotes(p => [note, ...p]);
        addLog('UPLOAD_NOTE', `Added note: ${noteForm.title}`);
        setNoteForm({ title: '', subject: '', chapter: '', grade: '10', description: '', driveLink: '', uploadType: 'link', pdfFile: null, pdfData: null });
        alert('Note added!');
      } else alert('Fill all required fields');
    };

    const handleUploadVideo = () => {
      if (!currentUser) { alert('Login first'); return; }
      if (videoForm.title && videoForm.subject && videoForm.chapter) {
        if (videoForm.uploadType === 'link' && !videoForm.videoUrl) {
          alert('Please provide a video link');
          return;
        }
        if (videoForm.uploadType === 'link' && !getEmbedUrl(videoForm.videoUrl)) { 
          alert('Please provide a valid video link'); 
          return; 
        }
        if (videoForm.uploadType === 'file' && !videoForm.videoData) {
          alert('Please select a video file');
          return;
        }
        const video = { 
          id: Date.now(), 
          type: 'video',
          title: videoForm.title,
          subject: videoForm.subject,
          chapter: videoForm.chapter,
          grade: videoForm.grade,
          description: videoForm.description,
          uploadType: videoForm.uploadType,
          videoUrl: videoForm.uploadType === 'link' ? videoForm.videoUrl : null,
          videoData: videoForm.uploadType === 'file' ? videoForm.videoData : null,
          videoFileName: videoForm.uploadType === 'file' ? videoForm.videoFile?.name : null,
          uploadedBy: currentUser.name, 
          uploaderId: currentUser.id, 
          uploadDate: new Date().toLocaleDateString(), 
          views: 0
        };
        setVideos(p => [video, ...p]);
        addLog('UPLOAD_VIDEO', `Added video: ${videoForm.title}`);
        setVideoForm({ title: '', subject: '', chapter: '', grade: '10', description: '', videoUrl: '', uploadType: 'link', videoFile: null, videoData: null });
        alert('Video added!');
      } else alert('Fill all required fields');
    };

    const handleEditNote = (note) => {
      setEditingNote(note);
      setNoteForm({ title: note.title, subject: note.subject, chapter: note.chapter, grade: note.grade, description: note.description, 
        driveLink: note.driveLink || '', uploadType: note.uploadType || 'link', pdfFile: null, pdfData: note.pdfData || null });
      addLog('EDIT_START', `Editing note: ${note.title}`);
      setCurrentView('home');
      setContentType('notes');
    };

    const handleEditVideo = (video) => {
      setEditingVideo(video);
      setVideoForm({ 
        title: video.title, 
        subject: video.subject, 
        chapter: video.chapter, 
        grade: video.grade, 
        description: video.description, 
        videoUrl: video.videoUrl || '',
        uploadType: video.uploadType || 'link',
        videoFile: null,
        videoData: video.videoData || null
      });
      addLog('EDIT_START', `Editing video: ${video.title}`);
      setCurrentView('home');
      setContentType('videos');
    };

    const handleUpdateNote = () => {
      if (noteForm.title && noteForm.subject && noteForm.chapter && editingNote) {
        if (noteForm.uploadType === 'link' && !noteForm.driveLink) { alert('Please provide a link'); return; }
        if (noteForm.uploadType === 'pdf' && !noteForm.pdfData && !editingNote.pdfData) { alert('Please select a PDF'); return; }
        setNotes(p => p.map(n => n.id === editingNote.id ? { 
          ...n, title: noteForm.title, subject: noteForm.subject, chapter: noteForm.chapter, grade: noteForm.grade, description: noteForm.description,
          uploadType: noteForm.uploadType, driveLink: noteForm.uploadType === 'link' ? noteForm.driveLink : null,
          pdfData: noteForm.uploadType === 'pdf' ? (noteForm.pdfData || n.pdfData) : null,
          pdfFileName: noteForm.uploadType === 'pdf' ? (noteForm.pdfFile?.name || n.pdfFileName) : null,
          uploadDate: new Date().toLocaleDateString() + ' (Updated)' 
        } : n));
        addLog('UPDATE', `Updated note: ${noteForm.title}`);
        setNoteForm({ title: '', subject: '', chapter: '', grade: '10', description: '', driveLink: '', uploadType: 'link', pdfFile: null, pdfData: null });
        setEditingNote(null);
        alert('Note updated!');
      } else alert('Fill all required fields');
    };

    const handleUpdateVideo = () => {
      if (videoForm.title && videoForm.subject && videoForm.chapter && editingVideo) {
        if (videoForm.uploadType === 'link' && !videoForm.videoUrl) {
          alert('Please provide a video link');
          return;
        }
        if (videoForm.uploadType === 'link' && !getEmbedUrl(videoForm.videoUrl)) { 
          alert('Please provide a valid video link'); 
          return; 
        }
        if (videoForm.uploadType === 'file' && !videoForm.videoData && !editingVideo.videoData) {
          alert('Please select a video file');
          return;
        }
        setVideos(p => p.map(v => v.id === editingVideo.id ? { 
          ...v, 
          title: videoForm.title,
          subject: videoForm.subject,
          chapter: videoForm.chapter,
          grade: videoForm.grade,
          description: videoForm.description,
          uploadType: videoForm.uploadType,
          videoUrl: videoForm.uploadType === 'link' ? videoForm.videoUrl : null,
          videoData: videoForm.uploadType === 'file' ? (videoForm.videoData || v.videoData) : null,
          videoFileName: videoForm.uploadType === 'file' ? (videoForm.videoFile?.name || v.videoFileName) : null,
          uploadDate: new Date().toLocaleDateString() + ' (Updated)' 
        } : v));
        addLog('UPDATE', `Updated video: ${videoForm.title}`);
        setVideoForm({ title: '', subject: '', chapter: '', grade: '10', description: '', videoUrl: '', uploadType: 'link', videoFile: null, videoData: null });
        setEditingVideo(null);
        alert('Video updated!');
      } else alert('Fill all required fields');
    };

    const handleDeleteNote = (id) => {
      const note = notes.find(n => n.id === id);
      if (!note) return;
      if (window.confirm('Delete this note?')) {
        setNotes(p => p.filter(n => n.id !== id));
        addLog('DELETE', `Deleted note: ${note.title}`);
      }
    };

    const handleDeleteVideo = (id) => {
      const video = videos.find(v => v.id === id);
      if (!video) return;
      if (window.confirm('Delete this video?')) {
        setVideos(p => p.filter(v => v.id !== id));
        addLog('DELETE', `Deleted video: ${video.title}`);
      }
    };

    const handlePDFUpload = (e) => {
      const file = e.target.files[0];
      if (file && file.type === 'application/pdf') {
        const reader = new FileReader();
        reader.onload = (ev) => {
          setNoteForm({...noteForm, pdfFile: file, pdfData: ev.target.result});
        };
        reader.readAsDataURL(file);
      } else {
        alert('Please select a valid PDF file');
        e.target.value = '';
      }
    };

    const handleVideoFileUpload = (e) => {
      const file = e.target.files[0];
      if (file && file.type.startsWith('video/')) {
        if (file.size > 100 * 1024 * 1024) {
          alert('Video file is too large. Maximum size is 100MB. For larger videos, please use YouTube or Google Drive links.');
          e.target.value = '';
          return;
        }
        const reader = new FileReader();
        reader.onload = (ev) => {
          setVideoForm({...videoForm, videoFile: file, videoData: ev.target.result});
        };
        reader.readAsDataURL(file);
      } else {
        alert('Please select a valid video file (MP4, WebM, etc.)');
        e.target.value = '';
      }
    };

    const viewPDF = (pdfData, title) => {
      const newWindow = window.open();
      newWindow.document.write(`<iframe width='100%' height='100%' src='${pdfData}'></iframe>`);
      addLog('VIEW', `Opened PDF: ${title}`);
    };

    const openLink = (link, title) => {
      window.open(link, '_blank');
      addLog('VIEW', `Opened link: ${title}`);
    };

    const handlePlayVideo = (video) => {
      setPlayingVideo(video);
      setVideos(p => p.map(v => v.id === video.id ? { ...v, views: (v.views || 0) + 1 } : v));
      addLog('VIEW', `Watched: ${video.title}`);
    };

    const playUploadedVideo = (videoData, title) => {
      const newWindow = window.open();
      newWindow.document.write(`
        <html>
          <head><title>${title}</title></head>
          <body style="margin:0;background:#000;">
            <video controls autoplay style="width:100%;height:100vh;">
              <source src="${videoData}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </body>
        </html>
      `);
      addLog('VIEW', `Watched uploaded video: ${title}`);
    };

    const exportLogs = () => {
      const csv = [['Time','User','Role','Action','Details'].join(','), ...logs.map(l => [`"${l.time}"`,`"${l.user}"`,`"${l.role}"`,`"${l.action}"`,`"${l.details.replace(/"/g,'""')}"`].join(','))].join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'logs.csv'; a.click();
    };

    const exportUsers = () => {
      const csv = [['Username','Password','Name','Role','Grade'].join(','), ...users.map(u => [`"${u.username}"`,`"${u.password}"`,`"${u.name}"`,`"${u.role}"`,`"${u.grade}"`].join(','))].join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'users.csv'; a.click();
    };

    const handleImportUsers = (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
          const text = ev.target.result;
          const lines = text.split('\n').map(l => l.trim()).filter(l => l);
          if (lines.length <= 1) { alert('No users found'); return; }
          const newUsers = lines.slice(1).map((line, i) => {
            const vals = safeCSVSplit(line);
            return { id: users.length + i + 1, username: vals[0]?.trim(), password: vals[1]?.trim(), name: vals[2]?.trim(), role: vals[3]?.trim() || 'student', grade: vals[4]?.trim() || '10' };
          }).filter(u => u.username && u.password);
          setUsers(p => [...p, ...newUsers]);
          alert(`Imported ${newUsers.length} users`);
        };
        reader.readAsText(file);
      }
      e.target.value = '';
    };

    const handleUpdateUser = (id, field, val) => setUsers(p => p.map(u => u.id === id ? { ...u, [field]: val } : u));

    const handleDeleteUser = (id) => {
      const user = users.find(u => u.id === id);
      if (!user) return;
      if (user.role === 'admin') { alert('Cannot delete admin'); return; }
      if (window.confirm(`Delete ${user.username}?`)) setUsers(p => p.filter(u => u.id !== id));
    };

    useEffect(() => {
      const content = contentType === 'notes' ? notes : videos;
      let filtered = content;
      if (currentUser?.role === 'student') filtered = filtered.filter(item => item.grade === currentUser.grade || item.grade === 'All');
      if (searchTerm) filtered = filtered.filter(item => (item.title || '').toLowerCase().includes(searchTerm.toLowerCase()) || (item.subject || '').toLowerCase().includes(searchTerm.toLowerCase()) || (item.chapter || '').toLowerCase().includes(searchTerm.toLowerCase()));
      if (selectedSubject) filtered = filtered.filter(item => item.subject === selectedSubject);
      setFilteredContent(filtered);
    }, [notes, videos, searchTerm, selectedSubject, currentUser, contentType]);

    const isTeacher = currentUser?.role === 'teacher';
    const isAdmin = currentUser?.role === 'admin';
    const isStudent = currentUser?.role === 'student';

    if (!currentUser) {
      return (
        <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-100 flex items-center justify-center p-4">
          <div className="bg-white rounded-xl shadow-2xl w-full max-w-md p-8">
            <div className="text-center mb-8">
              <div className="w-20 h-20 bg-gradient-to-br from-indigo-600 to-pink-600 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg">
                <span className="text-3xl font-black text-white">KS</span>
              </div>
              <h1 className="text-3xl font-bold text-gray-800">KS Tuitions</h1>
              <p className="text-gray-600 mt-2">Complete Learning Platform</p>
            </div>
            <div className="space-y-4">
              <input type="text" value={loginForm.username} onChange={(e)=>setLoginForm({...loginForm, username: e.target.value})} onKeyPress={(e)=>e.key==='Enter'&&handleLogin()} className="w-full px-4 py-2 border rounded-lg" placeholder="Username"/>
              <input type="password" value={loginForm.password} onChange={(e)=>setLoginForm({...loginForm, password: e.target.value})} onKeyPress={(e)=>e.key==='Enter'&&handleLogin()} className="w-full px-4 py-2 border rounded-lg" placeholder="Password"/>
              <button onClick={handleLogin} className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700">Login</button>
              <div className="text-sm text-gray-500 text-center"></div>
            </div>
          </div>
        </div>
      );
    }

    const Sidebar = () => (
      <div className={`fixed inset-y-0 left-0 w-64 bg-white shadow-lg transform ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 transition z-30`}>
        <div className="p-6 border-b">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <div className="w-10 h-10 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center">
                <span className="text-xl font-black text-white">KS</span>
              </div>
              <span className="font-bold text-lg">KS Tuitions</span>
            </div>
            <button onClick={()=>setSidebarOpen(false)} className="md:hidden"><X /></button>
          </div>
          <div className="mt-4 p-3 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-lg">
            <p className="text-sm font-semibold">{currentUser.name}</p>
            <p className="text-xs text-gray-500 capitalize">{currentUser.role}</p>
            {isStudent && <p className="text-xs text-indigo-600 font-semibold mt-1">Class {currentUser.grade}</p>}
          </div>
        </div>
        <nav className="p-4">
          <button onClick={() => { setCurrentView('home'); setSelectedSubject(null); setSidebarOpen(false); setPlayingVideo(null); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg mb-2 ${currentView === 'home' ? 'bg-indigo-100 text-indigo-700' : 'hover:bg-gray-100'}`}>
            <Home/> <span>Home</span>
          </button>
          <button onClick={() => { setCurrentView('notes'); setSelectedSubject(null); setSidebarOpen(false); setPlayingVideo(null); setContentType('notes'); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg mb-2 ${currentView === 'notes' ? 'bg-blue-100 text-blue-700' : 'hover:bg-gray-100'}`}>
            <FileText/> <span>Notes</span>
          </button>
          <button onClick={() => { setCurrentView('videos'); setSelectedSubject(null); setSidebarOpen(false); setPlayingVideo(null); setContentType('videos'); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg mb-2 ${currentView === 'videos' ? 'bg-purple-100 text-purple-700' : 'hover:bg-gray-100'}`}>
            <Video/> <span>Videos</span>
          </button>
          {isAdmin && <>
            <button onClick={() => { setCurrentView('users'); setSidebarOpen(false); setPlayingVideo(null); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg mb-2 ${currentView === 'users' ? 'bg-green-100 text-green-700' : 'hover:bg-gray-100'}`}>
              <Users/> <span>Users</span>
            </button>
            <button onClick={() => { setCurrentView('logs'); setSidebarOpen(false); setPlayingVideo(null); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg mb-2 ${currentView === 'logs' ? 'bg-orange-100 text-orange-700' : 'hover:bg-gray-100'}`}>
              <Activity/> <span>Logs</span>
            </button>
          </>}
          <div className="mt-4">
            <button onClick={handleLogout} className="w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-red-50 text-red-600">
              <LogOut/> <span>Logout</span>
            </button>
          </div>
        </nav>
      </div>
    );

    const renderContent = () => {
      if (currentView === 'users' && isAdmin) {
        return (
          <div className="bg-white rounded-lg shadow p-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-2xl font-bold">Users ({users.length})</h2>
              <div className="flex gap-2">
                <label className="px-4 py-2 bg-blue-600 text-white rounded-lg cursor-pointer text-sm">Import
                  <input type="file" accept=".csv" onChange={handleImportUsers} className="hidden" />
                </label>
                <button onClick={exportUsers} className="px-4 py-2 bg-green-600 text-white rounded-lg text-sm">Export</button>
              </div>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full text-sm">
                <thead className="bg-gray-50 border-b"><tr><th className="px-4 py-3 text-left text-xs">Username</th><th className="px-4 py-3 text-left text-xs">Password</th><th className="px-4 py-3 text-left text-xs">Name</th><th className="px-4 py-3 text-left text-xs">Role</th><th className="px-4 py-3 text-left text-xs">Grade</th><th className="px-4 py-3 text-left text-xs">Actions</th></tr></thead>
                <tbody className="divide-y">
                  {users.map(u => (
                    <tr key={u.id} className="hover:bg-gray-50">
                      <td className="px-4 py-3"><input type="text" value={u.username} onChange={(e)=>handleUpdateUser(u.id,'username',e.target.value)} className="w-full px-2 py-1 border rounded" /></td>
                      <td className="px-4 py-3"><input type="text" value={u.password} onChange={(e)=>handleUpdateUser(u.id,'password',e.target.value)} className="w-full px-2 py-1 border rounded" /></td>
                      <td className="px-4 py-3"><input type="text" value={u.name} onChange={(e)=>handleUpdateUser(u.id,'name',e.target.value)} className="w-full px-2 py-1 border rounded" /></td>
                      <td className="px-4 py-3"><select value={u.role} onChange={(e)=>handleUpdateUser(u.id,'role',e.target.value)} className="w-full px-2 py-1 border rounded"><option value="student">Student</option><option value="teacher">Teacher</option><option value="admin">Admin</option></select></td>
                      <td className="px-4 py-3">{u.role === 'student' ? <select value={u.grade} onChange={(e)=>handleUpdateUser(u.id,'grade',e.target.value)} className="w-full px-2 py-1 border rounded">{grades.map(g => <option key={g} value={g}>{g}</option>)}</select> : <span className="text-gray-400">N/A</span>}</td>
                      <td className="px-4 py-3"><button onClick={()=>handleDeleteUser(u.id)} disabled={u.role === 'admin'} className="p-1 bg-red-600 text-white rounded disabled:opacity-50"><Trash2 className="w-4 h-4" /></button></td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        );
      }

      if (currentView === 'logs' && isAdmin) {
        return (
          <div className="bg-white rounded-lg shadow p-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-2xl font-bold">Activity Logs ({logs.length})</h2>
              <div className="flex gap-2">
                <button onClick={exportLogs} className="px-4 py-2 bg-green-600 text-white rounded-lg text-sm">Export</button>
                <button onClick={() => window.confirm('Clear all logs?') && setLogs([])} className="px-4 py-2 bg-red-600 text-white rounded-lg text-sm">Clear</button>
              </div>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full text-sm">
                <thead className="bg-gray-50 border-b"><tr><th className="px-4 py-3 text-left text-xs">Time</th><th className="px-4 py-3 text-left text-xs">User</th><th className="px-4 py-3 text-left text-xs">Role</th><th className="px-4 py-3 text-left text-xs">Action</th><th className="px-4 py-3 text-left text-xs">Details</th></tr></thead>
                <tbody className="divide-y">
                  {logs.length === 0 ? <tr><td colSpan="5" className="px-4 py-8 text-center text-gray-500">No logs</td></tr> : logs.map(l => (
                    <tr key={l.id} className="hover:bg-gray-50">
                      <td className="px-4 py-3 text-xs">{l.time}</td>
                      <td className="px-4 py-3">{l.user}</td>
                      <td className="px-4 py-3"><span className={`px-2 py-1 rounded-full text-xs ${l.role === 'admin' ? 'bg-red-100 text-red-700' : l.role === 'teacher' ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'}`}>{l.role}</span></td>
                      <td className="px-4 py-3"><span className="px-2 py-1 rounded-full text-xs bg-gray-100">{l.action}</span></td>
                      <td className="px-4 py-3 text-gray-600">{l.details}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        );
      }

      if (playingVideo) {
        const embedUrl = playingVideo.uploadType === 'link' ? getEmbedUrl(playingVideo.videoUrl) : null;
        return (
          <div className="space-y-6">
            <div className="bg-white rounded-lg shadow p-6">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-2xl font-bold">{playingVideo.title}</h2>
                <button onClick={() => setPlayingVideo(null)} className="px-4 py-2 bg-gray-600 text-white rounded-lg">Back</button>
              </div>
              <div className="aspect-video bg-black rounded-lg overflow-hidden mb-4">
                {playingVideo.uploadType === 'file' ? (
                  <video controls className="w-full h-full" src={playingVideo.videoData}>
                    Your browser does not support the video tag.
                  </video>
                ) : embedUrl ? (
                  <iframe src={embedUrl} className="w-full h-full" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>
                ) : (
                  <div className="flex items-center justify-center h-full text-white">Invalid video URL</div>
                )}
              </div>
              <div className="space-y-2">
                <div className="flex gap-2 flex-wrap">
                  <span className="px-3 py-1 bg-purple-100 text-purple-700 text-sm rounded">{playingVideo.subject}</span>
                  <span className="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded">Grade {playingVideo.grade}</span>
                  <span className="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded">Ch: {playingVideo.chapter}</span>
                  <span className="px-3 py-1 bg-blue-100 text-blue-700 text-sm rounded">{playingVideo.views || 0} views</span>
                  {playingVideo.uploadType === 'file' && <span className="px-3 py-1 bg-green-100 text-green-700 text-sm rounded">Uploaded File</span>}
                </div>
                <p className="text-gray-600 mt-3">{playingVideo.description}</p>
                <p className="text-xs text-gray-400 mt-2">By {playingVideo.uploadedBy} on {playingVideo.uploadDate}</p>
              </div>
            </div>
          </div>
        );
      }

      if (selectedSubject) {
        return (
          <div className="space-y-6">
            <div className="bg-white rounded-lg shadow p-6">
              <div className="flex justify-between items-center mb-6">
                <div>
                  <h2 className="text-2xl font-bold">{selectedSubject}</h2>
                  <div className="flex gap-2 mt-2">
                    <button onClick={()=>setContentType('notes')} className={`px-3 py-1 rounded ${contentType==='notes'?'bg-blue-600 text-white':'bg-gray-200'}`}>Notes</button>
                    <button onClick={()=>setContentType('videos')} className={`px-3 py-1 rounded ${contentType==='videos'?'bg-purple-600 text-white':'bg-gray-200'}`}>Videos</button>
                  </div>
                </div>
                <button onClick={() => setSelectedSubject(null)} className="px-4 py-2 bg-gray-600 text-white rounded-lg">Back</button>
              </div>
              <div className="relative mb-6">
                <Search className="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2" />
                <input type="text" value={searchTerm} onChange={(e)=>setSearchTerm(e.target.value)} className="w-full pl-10 pr-4 py-3 border rounded-lg" placeholder="Search..." />
              </div>
              {contentType === 'notes' ? (
                <div className="space-y-4">
                  {filteredContent.length === 0 ? (
                    <div className="text-center py-12"><FileText className="w-16 h-16 text-gray-300 mx-auto mb-4" /><p className="text-gray-500">No notes</p></div>
                  ) : filteredContent.map(n => (
                    <div key={n.id} className="bg-white border rounded-lg p-6">
                      <div className="flex justify-between items-start">
                        <div className="flex-1">
                          <h3 className="text-lg font-bold">{n.title}</h3>
                          <div className="flex gap-2 mt-2 flex-wrap">
                            <span className="px-3 py-1 bg-blue-100 text-blue-700 text-xs rounded">{n.subject}</span>
                            <span className="px-3 py-1 bg-gray-100 text-gray-700 text-xs rounded">Grade {n.grade}</span>
                            <span className="px-3 py-1 bg-gray-100 text-gray-700 text-xs rounded">Ch: {n.chapter}</span>
                          </div>
                          <p className="text-sm text-gray-600 mt-3">{n.description}</p>
                          <p className="text-xs text-gray-400 mt-2">By {n.uploadedBy} on {n.uploadDate}</p>
                        </div>
                        <div className="flex flex-col items-end gap-2 ml-4">
                          {n.uploadType === 'pdf' ? (
                            <button onClick={()=>viewPDF(n.pdfData, n.title)} className="px-3 py-1 bg-blue-600 text-white rounded text-sm flex items-center gap-1">
                              <FileText className="w-4 h-4" /> View PDF
                            </button>
                          ) : (
                            <button onClick={()=>openLink(n.driveLink, n.title)} className="px-3 py-1 bg-blue-600 text-white rounded text-sm flex items-center gap-1">
                              <ExternalLink className="w-4 h-4" /> Open
                            </button>
                          )}
                          {(isTeacher || isAdmin) && <>
                            <button onClick={()=>handleEditNote(n)} className="px-3 py-1 bg-yellow-600 text-white rounded text-sm flex items-center gap-1"><Edit className="w-4 h-4" /> Edit</button>
                            <button onClick={()=>handleDeleteNote(n.id)} className="px-3 py-1 bg-red-600 text-white rounded text-sm flex items-center gap-1"><Trash2 className="w-4 h-4" /> Delete</button>
                          </>}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {filteredContent.length === 0 ? (
                    <div className="col-span-full text-center py-12"><Video className="w-16 h-16 text-gray-300 mx-auto mb-4" /><p className="text-gray-500">No videos</p></div>
                  ) : filteredContent.map(v => (
                    <div key={v.id} className="bg-white border rounded-lg overflow-hidden hover:shadow-lg transition">
                      <div className="aspect-video bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center cursor-pointer" onClick={()=>handlePlayVideo(v)}>
                        <Play className="w-16 h-16 text-purple-600" />
                      </div>
                      <div className="p-4">
                        <h3 className="font-bold text-lg mb-2 line-clamp-2">{v.title}</h3>
                        <div className="flex gap-2 mb-2 flex-wrap">
                          <span className="px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded">{v.subject}</span>
                          <span className="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded">{v.views || 0} views</span>
                        </div>
                        <p className="text-sm text-gray-600 line-clamp-2 mb-3">{v.description}</p>
                        <div className="flex gap-2">
                          <button onClick={()=>handlePlayVideo(v)} className="flex-1 px-3 py-2 bg-purple-600 text-white rounded text-sm flex items-center justify-center gap-1">
                            <Play className="w-4 h-4" /> Watch
                          </button>
                          {(isTeacher || isAdmin) && (
                            <>
                              <button onClick={()=>handleEditVideo(v)} className="px-3 py-2 bg-yellow-600 text-white rounded text-sm"><Edit className="w-4 h-4" /></button>
                              <button onClick={()=>handleDeleteVideo(v.id)} className="px-3 py-2 bg-red-600 text-white rounded text-sm"><Trash2 className="w-4 h-4" /></button>
                            </>
                          )}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      }

      if (currentView === 'notes' || currentView === 'videos' || currentView === 'home') {
        return (
          <div className="space-y-6">
            {(isTeacher || isAdmin) && (
              <>
                {(currentView === 'notes' || (currentView === 'home' && contentType === 'notes')) && (
                  <div className="bg-white rounded-lg shadow p-6">
                    <h2 className="text-2xl font-bold mb-4">{editingNote ? 'Edit Note' : 'Upload Note'}</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <input type="text" value={noteForm.title} onChange={(e)=>setNoteForm({...noteForm, title: e.target.value})} className="px-4 py-2 border rounded-lg" placeholder="Title *" />
                      <select value={noteForm.subject} onChange={(e)=>setNoteForm({...noteForm, subject: e.target.value})} className="px-4 py-2 border rounded-lg">
                        <option value="">Select Subject *</option>
                        {subjects.map(s => <option key={s} value={s}>{s}</option>)}
                      </select>
                      <input type="text" value={noteForm.chapter} onChange={(e)=>setNoteForm({...noteForm, chapter: e.target.value})} className="px-4 py-2 border rounded-lg" placeholder="Chapter *" />
                      <select value={noteForm.grade} onChange={(e)=>setNoteForm({...noteForm, grade: e.target.value})} className="px-4 py-2 border rounded-lg">
                        <option value="All">All Grades</option>
                        {grades.map(g => <option key={g} value={g}>Grade {g}</option>)}
                      </select>
                      <div className="md:col-span-2">
                        <label className="block text-sm font-semibold mb-2">Upload Type *</label>
                        <div className="flex gap-4">
                          <label className="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="uploadType" value="link" checked={noteForm.uploadType === 'link'} onChange={(e)=>setNoteForm({...noteForm, uploadType: e.target.value, pdfFile: null, pdfData: null})} className="w-4 h-4" />
                            <span>Link (Drive/Docs)</span>
                          </label>
                          <label className="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="uploadType" value="pdf" checked={noteForm.uploadType === 'pdf'} onChange={(e)=>setNoteForm({...noteForm, uploadType: e.target.value, driveLink: ''})} className="w-4 h-4" />
                            <span>Upload PDF</span>
                          </label>
                        </div>
                      </div>
                      {noteForm.uploadType === 'link' ? (
                        <input type="text" value={noteForm.driveLink} onChange={(e)=>setNoteForm({...noteForm, driveLink: e.target.value})} className="px-4 py-2 border rounded-lg md:col-span-2" placeholder="Google Drive / Docs Link *" />
                      ) : (
                        <div className="md:col-span-2">
                          <label className="block px-4 py-2 border-2 border-dashed rounded-lg text-center cursor-pointer hover:border-blue-500">
                            {noteForm.pdfFile ? (
                              <span className="text-green-600">✓ {noteForm.pdfFile.name}</span>
                            ) : editingNote?.pdfFileName ? (
                              <span className="text-blue-600">Current: {editingNote.pdfFileName}</span>
                            ) : (
                              <span className="text-gray-500">Click to select PDF *</span>
                            )}
                            <input type="file" accept=".pdf" onChange={handlePDFUpload} className="hidden" />
                          </label>
                        </div>
                      )}
                      <textarea value={noteForm.description} onChange={(e)=>setNoteForm({...noteForm, description: e.target.value})} className="px-4 py-2 border rounded-lg md:col-span-2" placeholder="Description" rows="3"></textarea>
                    </div>
                    <div className="flex gap-2 mt-4">
                      {editingNote ? (
                        <>
                          <button onClick={handleUpdateNote} className="px-6 py-2 bg-green-600 text-white rounded-lg">Update</button>
                          <button onClick={()=>{setEditingNote(null);setNoteForm({ title: '', subject: '', chapter: '', grade: '10', description: '', driveLink: '', uploadType: 'link', pdfFile: null, pdfData: null });}} className="px-6 py-2 bg-gray-600 text-white rounded-lg">Cancel</button>
                        </>
                      ) : (
                        <button onClick={handleUploadNote} className="px-6 py-2 bg-blue-600 text-white rounded-lg">Upload Note</button>
                      )}
                    </div>
                  </div>
                )}
                {(currentView === 'videos' || (currentView === 'home' && contentType === 'videos')) && (
                  <div className="bg-white rounded-lg shadow p-6">
                    <h2 className="text-2xl font-bold mb-4">{editingVideo ? 'Edit Video' : 'Upload Video'}</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <input type="text" value={videoForm.title} onChange={(e)=>setVideoForm({...videoForm, title: e.target.value})} className="px-4 py-2 border rounded-lg" placeholder="Video Title *" />
                      <select value={videoForm.subject} onChange={(e)=>setVideoForm({...videoForm, subject: e.target.value})} className="px-4 py-2 border rounded-lg">
                        <option value="">Select Subject *</option>
                        {subjects.map(s => <option key={s} value={s}>{s}</option>)}
                      </select>
                      <input type="text" value={videoForm.chapter} onChange={(e)=>setVideoForm({...videoForm, chapter: e.target.value})} className="px-4 py-2 border rounded-lg" placeholder="Chapter *" />
                      <select value={videoForm.grade} onChange={(e)=>setVideoForm({...videoForm, grade: e.target.value})} className="px-4 py-2 border rounded-lg">
                        <option value="All">All Grades</option>
                        {grades.map(g => <option key={g} value={g}>Grade {g}</option>)}
                      </select>
                      
                      <div className="md:col-span-2">
                        <label className="block text-sm font-semibold mb-2">Upload Type *</label>
                        <div className="flex gap-4">
                          <label className="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="videoUploadType" value="link" checked={videoForm.uploadType === 'link'} onChange={(e)=>setVideoForm({...videoForm, uploadType: e.target.value, videoFile: null, videoData: null})} className="w-4 h-4" />
                            <span>Video Link (YouTube/Drive)</span>
                          </label>
                          <label className="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="videoUploadType" value="file" checked={videoForm.uploadType === 'file'} onChange={(e)=>setVideoForm({...videoForm, uploadType: e.target.value, videoUrl: ''})} className="w-4 h-4" />
                            <span>Upload Video File</span>
                          </label>
                        </div>
                      </div>

                      {videoForm.uploadType === 'link' ? (
                        <input type="text" value={videoForm.videoUrl} onChange={(e)=>setVideoForm({...videoForm, videoUrl: e.target.value})} className="px-4 py-2 border rounded-lg md:col-span-2" placeholder="Video URL (YouTube, Google Drive, Vimeo) *" />
                      ) : (
                        <div className="md:col-span-2">
                          <label className="block px-4 py-2 border-2 border-dashed rounded-lg text-center cursor-pointer hover:border-purple-500">
                            {videoForm.videoFile ? (
                              <span className="text-green-600">✓ {videoForm.videoFile.name} ({(videoForm.videoFile.size / (1024*1024)).toFixed(2)} MB)</span>
                            ) : editingVideo?.videoFileName ? (
                              <span className="text-blue-600">Current: {editingVideo.videoFileName}</span>
                            ) : (
                              <span className="text-gray-500">Click to select video file (MP4, WebM, max 100MB) *</span>
                            )}
                            <input type="file" accept="video/*" onChange={handleVideoFileUpload} className="hidden" />
                          </label>
                        </div>
                      )}

                      <textarea value={videoForm.description} onChange={(e)=>setVideoForm({...videoForm, description: e.target.value})} className="px-4 py-2 border rounded-lg md:col-span-2" placeholder="Description" rows="3"></textarea>
                    </div>
                    <div className="mt-4 p-3 bg-purple-50 rounded-lg text-sm text-purple-700">
                      <strong>Note:</strong> Uploaded videos are stored in browser (max 100MB). For larger videos, use YouTube or Google Drive links.
                    </div>
                    <div className="flex gap-2 mt-4">
                      {editingVideo ? (
                        <>
                          <button onClick={handleUpdateVideo} className="px-6 py-2 bg-green-600 text-white rounded-lg">Update</button>
                          <button onClick={()=>{setEditingVideo(null);setVideoForm({ title: '', subject: '', chapter: '', grade: '10', description: '', videoUrl: '', uploadType: 'link', videoFile: null, videoData: null });}} className="px-6 py-2 bg-gray-600 text-white rounded-lg">Cancel</button>
                        </>
                      ) : (
                        <button onClick={handleUploadVideo} className="px-6 py-2 bg-purple-600 text-white rounded-lg">Upload Video</button>
                      )}
                    </div>
                  </div>
                )}
              </>
            )}
            <div className="bg-white rounded-lg shadow p-6">
              <h2 className="text-2xl font-bold mb-6">Browse by Subject</h2>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {subjects.map(subject => {
                  const noteCount = notes.filter(n => {
                    if (isStudent) return n.subject === subject && (n.grade === currentUser.grade || n.grade === 'All');
                    return n.subject === subject;
                  }).length;
                  const videoCount = videos.filter(v => {
                    if (isStudent) return v.subject === subject && (v.grade === currentUser.grade || v.grade === 'All');
                    return v.subject === subject;
                  }).length;
                  return (
                    <button key={subject} onClick={() => {setSelectedSubject(subject);setContentType('notes');}} className="p-6 border-2 rounded-xl hover:border-indigo-500 hover:shadow-lg transition text-left">
                      <div className="flex items-center gap-3 mb-2">
                        <BookOpen className="w-8 h-8 text-indigo-600" />
                        <h3 className="font-bold text-lg">{subject}</h3>
                      </div>
                      <div className="flex gap-3 text-sm text-gray-600">
                        <span className="flex items-center gap-1"><FileText className="w-4 h-4" /> {noteCount} notes</span>
                        <span className="flex items-center gap-1"><Video className="w-4 h-4" /> {videoCount} videos</span>
                      </div>
                    </button>
                  );
                })}
              </div>
            </div>
          </div>
        );
      }
    };

    return (
      <div className="min-h-screen bg-gray-50">
        <Sidebar />
        <div className="md:ml-64">
          <header className="bg-white shadow-sm sticky top-0 z-20">
            <div className="flex items-center justify-between p-4">
              <button onClick={()=>setSidebarOpen(true)} className="md:hidden"><Menu /></button>
              <h1 className="text-xl font-bold">KS Tuitions</h1>
              <div className="flex items-center gap-2">
                <span className="text-sm text-gray-600">{currentUser.name}</span>
              </div>
            </div>
          </header>
          <main className="p-4 md:p-6">
            {renderContent()}
          </main>
        </div>
      </div>
    );
  };

  ReactDOM.render(<CompleteApp />, document.getElementById('root'));
  </script>
</body>
</html>